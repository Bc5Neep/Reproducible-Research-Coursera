---
title: "Reproduceable Research Project 1"
author: "Bobby Sims"
date: "`r Sys.Date()`"
output: html_document
---

### Load libraries

```{r}
library(tidyverse)
```
### Import file and create data object

```{r echo = TRUE} 
activity <- read_csv("activity.csv")
sum(activity$steps, na.rm = TRUE)
```

### Designate values for aggregation

```{r} 
Steps = activity$steps
Date = activity$date
Interval = activity$interval
SD <- aggregate(Steps~Date, data = activity, sum)
SDI <- aggregate(Steps~Date + Interval, activity, sum)
```

### Calculate Total Number of Steps Taken per Day

```{r}
ggplot(SD, aes( x = Date, weight = Steps))+
  geom_histogram(binwidth = 1,
                 fill = "blue",
                 color = "black")+
  labs(title = "Total Steps Taken Each Day",
       x = "Date",
       y = "Steps")
```

### Calculate and report mean and median of the total number of steps taken daily

#### Mean

```{r}
mean(SD$Steps, trim = 0, na.rm =TRUE)
```
### Generate plot
```{r}
hist(SD$Steps, breaks = 53, main = "Total Steps Daily", xlab = "steps")
abline(v = mean(SD$Steps),
       col ="red",
       lwd = 3)
text( x = mean(SD$Steps),
      y = 5.5,
      labels = sprintf("Mean = %.2f", mean(SD$Steps)),
      col ="black",
      pos = 4)
```

#### Median

```{r}
median(SD$Steps)
```
### Generate plot

```{r}
hist(SD$Steps, breaks = 53, main = "Total Steps Daily", xlab = "steps")
abline(v = median (SD$Steps),
       col = "black",
       lwd =5)
text( x = median(SD$Steps),
      y = 5.5,
      labels = sprintf("Median = %.2f", median(SD$Steps)),
      col ="black",
      pos = 4)
```

### Generate time series plot with 5 minute interval and average number of steps taken

#### Average steps per interval across days 
```{r}
SD1 <- aggregate(Steps~Interval, data = activity, mean)
```

#### Determine range

```{r}
range(SD1$Steps)
```

#### Identify max mean steps and interval 

```{r}
Max1 <- SD1 [which.max(SD1$Steps),]
x1 <- Max1$Interval
y1 <- Max1$Steps
```

### Generate plot

```{r}
plot(SD1$Interval, SD1$Steps, 
     type = "l",
     xlab = "Intervals (5 min)", 
     ylab = "Steps", 
     main = "Average Daily Step Activity")
abline( v = 835,
        col ="red",
        lwd =2)
text(x = 865, y = 190,
     labels = sprintf("Max Avg Steps = %.2f at interval 835", (y1)),
     adj = 0,
     cex =0.6)
```

### Calculate total number of NA values

```{r}
colSums(is.na(activity))
```

### What are their row numbers? First expand max.print and print list
```{r}
options(max.print = 3000)
which(is.na(activity))
```

### Identify and isolate NAs

```{r}
NA_ROWS <- activity %>%
  slice (c(1:288, 2017:2304, 8929:9216, 9793:10080, 11233:11520, 11521:11808, 12673:12960, 17281:17568))
```

### Preview overlay of isolated NA with mean activity values per interval

```{r}
NA_OCT1 <- NA_ROWS[1:288,]

NA_Overlay_Oct1 <- cbind(SD1, NA_OCT1)
```

## Create a new dataset that is equal to the original dataset but with the missing data filled in

### Make duplicate activity dataset for imputing NAs

```{r}
activity_1 <- activity
```
### Concatenate NA row segments

```{r}
segments <- c(1:288, 2017:2304, 8929:9216, 9793:10080, 11233:11520, 11521:11808, 12673:12960, 17281:17568)
```

### Define NA replacement schema

```{r}
Idx <- is.na(activity_1$steps) & seq_along(activity_1$steps) %in% segments
```

### Impute mean interval values into NAs

```{r}
activity_1$steps <- replace(activity_1$steps, Idx, SD1$Steps[match(activity_1$interval[Idx], SD1$Interval)])
```


### Generate Total Daily Steps Histogram

```{r} 
SD2 <- aggregate(steps~date, data = activity_1, sum)

ggplot(SD2, aes( x = date, weight = steps))+
  geom_histogram(binwidth = 1,
                 fill = "blue",
                 color = "black")+
  labs(title = "Total Steps Taken Each Day",
       x = "Date",
       y = "Steps")
```       

### Calculate and report mean and median of the total number of steps taken daily




#### Mean
```{r}
mean(SD2$steps, trim = 0, na.rm =TRUE)
```


### Generate plot
```{r}
hist(SD2$steps, breaks = 61, main = "Total Steps Daily", xlab = "steps")
abline(v = mean(SD2$steps),
       col = "red",
       lwd = 3)
text( x = mean(SD2$steps),
      y = 5.5,
      labels = sprintf("Mean = %.2f", mean(SD2$steps)),
      col ="black",
      pos = 4)
```
  
### Median
```{r}
median(SD2$steps)
```

### Generate plot
```{r}
hist(SD2$steps, breaks = 61, main = "Total Steps Daily", xlab = "steps")
abline(v = median (SD2$steps),
       col = "black",
       lwd =5)
text( x = median(SD2$steps),
      y = 5.5,
      labels = sprintf("Median = %.2f", median(SD2$steps)),
      col ="black",
      pos = 4)
```      
      
  

